<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="博客" />
       
      <meta name="description" content="日常随笔" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>Linux主机安全检测脚本和初始化脚本 |  Lijintao&#39;s Blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="Lijintao's Blog" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="Scripts-Linux主机安全检测脚本和初始化脚本"
  class="article article-type-Scripts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Linux主机安全检测脚本和初始化脚本
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/03/04/Linux%E4%B8%BB%E6%9C%BA%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B%E8%84%9A%E6%9C%AC%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E8%84%9A%E6%9C%AC/" class="article-date">
  <time datetime="2024-03-04T05:39:24.000Z" itemprop="datePublished">2024-03-04</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Scripts/">Scripts</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">7.6k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">43 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="一-主机安全检查脚本"><a href="#一-主机安全检查脚本" class="headerlink" title="[一] 主机安全检查脚本"></a>[一] 主机安全检查脚本</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">##<span class="title class_">Filename</span>:     <span class="title class_">CentOS</span>_Check_Script.<span class="property">sh</span></span><br><span class="line">##<span class="title class_">Description</span>:  <span class="title class_">Security</span> detection script</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;##########################################################################&quot;</span></span><br><span class="line">echo <span class="string">&quot;#                                                                        #&quot;</span></span><br><span class="line">echo <span class="string">&quot;#                         health check script                            #&quot;</span></span><br><span class="line">echo <span class="string">&quot;#                                                                        #&quot;</span></span><br><span class="line">echo <span class="string">&quot;#警告:本脚本只是一个检查的操作,未对服务器做任何修改,管理员可以根据此报告 #&quot;</span></span><br><span class="line">echo <span class="string">&quot;#进行相应的安全整改                                                      #&quot;</span></span><br><span class="line">echo <span class="string">&quot;##########################################################################&quot;</span></span><br><span class="line">echo <span class="string">&quot; &quot;</span></span><br><span class="line">#read -p <span class="string">&quot;=====================Are You Ready,Please press enter==================&quot;</span></span><br><span class="line">echo <span class="string">&quot; &quot;</span></span><br><span class="line">echo <span class="string">&quot;##########################################################################&quot;</span></span><br><span class="line">echo <span class="string">&quot;#                                                                        #&quot;</span></span><br><span class="line">echo <span class="string">&quot;#                               主机安全检测                             #&quot;</span></span><br><span class="line">echo <span class="string">&quot;#                                                                        #&quot;</span></span><br><span class="line">echo <span class="string">&quot;##########################################################################&quot;</span></span><br><span class="line">echo <span class="string">&quot; &quot;</span></span><br><span class="line">echo <span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;系统基本信息&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span></span><br><span class="line">hostname=$(uname -n)</span><br><span class="line">system=$(cat /etc/os-release | grep <span class="string">&quot;^NAME&quot;</span> | awk -F\<span class="string">&quot; &#x27;&#123;print $2&#125;&#x27;)</span></span><br><span class="line"><span class="string">version=$(cat /etc/redhat-release | awk &#x27;&#123;print $4$5&#125;&#x27;)</span></span><br><span class="line"><span class="string">kernel=$(uname -r)</span></span><br><span class="line"><span class="string">platform=$(uname -p)</span></span><br><span class="line"><span class="string">address=$(ip addr | grep inet | grep -v &quot;</span>inet6<span class="string">&quot; | grep -v &quot;</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">&quot; | awk &#x27;&#123; print $2; &#125;&#x27; | tr &#x27;\n&#x27; &#x27;\t&#x27; )</span></span><br><span class="line"><span class="string">cpumodel=$(cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq)</span></span><br><span class="line"><span class="string">cpu=$(cat /proc/cpuinfo | grep &#x27;processor&#x27; | sort | uniq | wc -l)</span></span><br><span class="line"><span class="string">machinemodel=$(dmidecode | grep &quot;</span><span class="title class_">Product</span> <span class="title class_">Name</span><span class="string">&quot; | sed &#x27;s/^[ \t]*//g&#x27; | tr &#x27;\n&#x27; &#x27;\t&#x27; )</span></span><br><span class="line"><span class="string">date=$(date)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;</span>主机名:           $hostname<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统名称:         $system<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统版本:         $version<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>内核版本:         $kernel<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统类型:         $platform<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>本机<span class="variable constant_">IP</span>地址:       $address<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="variable constant_">CPU</span>型号:          $cpumodel<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span><span class="variable constant_">CPU</span>核数:          $cpu<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>机器型号:         $machinemodel<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统时间:         $date<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;资源使用情况&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">summemory=$(free -h |grep &quot;</span><span class="title class_">Mem</span>:<span class="string">&quot; | awk &#x27;&#123;print $2&#125;&#x27;)</span></span><br><span class="line"><span class="string">freememory=$(free -h |grep &quot;</span><span class="title class_">Mem</span>:<span class="string">&quot; | awk &#x27;&#123;print $4&#125;&#x27;)</span></span><br><span class="line"><span class="string">usagememory=$(free -h |grep &quot;</span><span class="title class_">Mem</span>:<span class="string">&quot; | awk &#x27;&#123;print $3&#125;&#x27;)</span></span><br><span class="line"><span class="string">uptime=$(uptime | awk &#x27;&#123;print $2&quot;</span> <span class="string">&quot;$3&quot;</span> <span class="string">&quot;$4&quot;</span> <span class="string">&quot;$5&#125;&#x27; | sed &#x27;s/,$//g&#x27;)</span></span><br><span class="line"><span class="string">loadavg=$(uptime | awk &#x27;&#123;print $9&quot;</span> <span class="string">&quot;$10&quot;</span> <span class="string">&quot;$11&quot;</span> <span class="string">&quot;$12&quot;</span> <span class="string">&quot;$13&#125;&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;</span>总内存大小:           $summemory<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>已使用内存大小:       $usagememory<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>可使用内存大小:       $freememory<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统运行时间:         $uptime<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统负载:             $loadavg<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>内存状态:<span class="string">&quot;</span></span><br><span class="line"><span class="string">vmstat 2 5</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>僵尸进程:<span class="string">&quot;</span></span><br><span class="line"><span class="string">ps -ef | grep zombie | grep -v grep</span></span><br><span class="line"><span class="string">if [ $? == 1 ];then</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;无僵尸进程<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;有僵尸进程------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>耗<span class="variable constant_">CPU</span>最多的进程:<span class="string">&quot;</span></span><br><span class="line"><span class="string">ps auxf |sort -nr -k 3 |head -5</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>耗内存最多的进程:<span class="string">&quot;</span></span><br><span class="line"><span class="string">ps auxf |sort -nr -k 4 |head -5</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>环境变量:<span class="string">&quot;</span></span><br><span class="line"><span class="string">env</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>路由表:<span class="string">&quot;</span></span><br><span class="line"><span class="string">route -n</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>监听端口:<span class="string">&quot;</span></span><br><span class="line"><span class="string">netstat -tunlp</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>当前建立的连接:<span class="string">&quot;</span></span><br><span class="line"><span class="string">netstat -n | awk &#x27;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&#x27;</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>开机启动的服务:<span class="string">&quot;</span></span><br><span class="line"><span class="string">systemctl list-unit-files | grep enabled</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;系统用户情况&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>活动用户:<span class="string">&quot;</span></span><br><span class="line"><span class="string">w | tail -n +2</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>系统所有用户:<span class="string">&quot;</span></span><br><span class="line"><span class="string">cut -d: -f1,2,3,4 /etc/passwd</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>系统所有组:<span class="string">&quot;</span></span><br><span class="line"><span class="string">cut -d: -f1,2,3 /etc/group</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>当前用户的计划任务:<span class="string">&quot;</span></span><br><span class="line"><span class="string">crontab -l</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;身份鉴别安全&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">grep -i &quot;</span>^password.*requisite.*pam_cracklib.<span class="property">so</span><span class="string">&quot; /etc/pam.d/system-auth  &gt; /dev/null</span></span><br><span class="line"><span class="string">if [ $? == 0 ];then</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;密码复杂度:已设置<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">    grep -i &quot;</span>pam_pwquality\.<span class="property">so</span><span class="string">&quot; /etc/pam.d/system-auth &gt; /dev/null</span></span><br><span class="line"><span class="string">    if [ $? == 0 ];then</span></span><br><span class="line"><span class="string">	echo &quot;</span>&gt;&gt;&gt;密码复杂度:已设置<span class="string">&quot;</span></span><br><span class="line"><span class="string">    else</span></span><br><span class="line"><span class="string">	echo &quot;</span>&gt;&gt;&gt;密码复杂度:未设置,请加固密码--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">    fi</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">awk -F&quot;</span>:<span class="string">&quot; &#x27;&#123;if($2!~/^!|^*/)&#123;print &quot;</span>&gt;&gt;&gt;(<span class="string">&quot;$1&quot;</span>)<span class="string">&quot; &quot;</span> 是一个未被锁定的账户,请管理员检查是否是可疑账户--------[需调整]<span class="string">&quot;&#125;&#125;&#x27; /etc/shadow</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">more /etc/login.defs | grep -E &quot;</span><span class="variable constant_">PASS_MAX_DAYS</span><span class="string">&quot; | grep -v &quot;</span>#<span class="string">&quot; |awk -F&#x27; &#x27;  &#x27;&#123;if($2!=90)&#123;print &quot;</span>&gt;&gt;&gt;密码过期天数是<span class="string">&quot;$2&quot;</span>天,请管理员改成<span class="number">90</span>天------[需调整]<span class="string">&quot;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">grep -i &quot;</span>^auth.*required.*pam_tally2.<span class="property">so</span>.*$<span class="string">&quot; /etc/pam.d/sshd  &gt; /dev/null</span></span><br><span class="line"><span class="string">if [ $? == 0 ];then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;登入失败处理:已开启<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;登入失败处理:未开启,请加固登入失败锁定功能----------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;访问控制安全&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统中存在以下非系统默认用户:<span class="string">&quot;</span></span><br><span class="line"><span class="string">more /etc/passwd |awk -F &quot;</span>:<span class="string">&quot; &#x27;&#123;if($3&gt;500)&#123;print &quot;</span>&gt;&gt;&gt;<span class="regexp">/etc/</span>passwd里面的<span class="string">&quot;$1 &quot;</span>的<span class="variable constant_">UID</span>为<span class="string">&quot;$3&quot;</span>，该账户非系统默认账户，请管理员确认是否为可疑账户--------[需调整]<span class="string">&quot;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统特权用户:<span class="string">&quot;</span></span><br><span class="line"><span class="string">awk -F: &#x27;$3==0 &#123;print $1&#125;&#x27; /etc/passwd</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统中空口令账户:<span class="string">&quot;</span></span><br><span class="line"><span class="string">awk -F: &#x27;($2==&quot;</span>!!<span class="string">&quot;) &#123;print $1&quot;</span>该账户为空口令账户，请管理员确认是否为新增账户，如果为新建账户，请配置密码-------[需调整]<span class="string">&quot;&#125;&#x27; /etc/shadow</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;安全审计&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>正常情况下登录到本机<span class="number">30</span>天内的所有用户的历史记录:<span class="string">&quot;</span></span><br><span class="line"><span class="string">last | head -n 30</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>查看syslog日志审计服务是否开启:<span class="string">&quot;</span></span><br><span class="line"><span class="string">if service rsyslog status | egrep &quot;</span> active \(running<span class="string">&quot;;then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;经分析,syslog服务已开启<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;经分析,syslog服务未开启，建议通过service rsyslog start开启日志审计功能---------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>查看syslog日志是否开启外发:<span class="string">&quot;</span></span><br><span class="line"><span class="string">if more /etc/rsyslog.conf | egrep &quot;</span>@...\.|@..\.|@.\.|\*.\* @...\.|\*\.\* @..\.|\*\.\* @.\.<span class="string">&quot;;then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;经分析,客户端syslog日志已开启外发--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;经分析,客户端syslog日志未开启外发---------[无需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>审计的要素和审计日志:<span class="string">&quot;</span></span><br><span class="line"><span class="string">more /etc/rsyslog.conf  | grep -v &quot;</span>^[$|#]<span class="string">&quot; | grep -v &quot;</span>^$<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统中关键文件修改时间:<span class="string">&quot;</span></span><br><span class="line"><span class="string">ls -ltr /bin/ls /bin/login /etc/passwd  /bin/ps /etc/shadow|awk &#x27;&#123;print &quot;</span>&gt;&gt;&gt;文件名：<span class="string">&quot;$9&quot;</span>  <span class="string">&quot;&quot;</span>最后修改时间：<span class="string">&quot;$6&quot;</span> <span class="string">&quot;$7&quot;</span> <span class="string">&quot;$8&#125;&#x27;</span></span><br><span class="line"><span class="string">echo &quot;</span></span><br><span class="line">###############################################################################################</span><br><span class="line">#   ls文件:是存储ls命令的功能函数,被删除以后,就无法执行ls命令                                 #</span><br><span class="line">#   login文件:login是控制用户登录的文件,一旦被篡改或删除,系统将无法切换用户或登陆用户         #</span><br><span class="line">#   /etc/passwd是一个文件,主要是保存用户信息                                                  #</span><br><span class="line">#   /bin/ps 进程查看命令功能支持文件,文件损坏或被更改后,无法正常使用ps命令                    #</span><br><span class="line">#   /etc/shadow是/etc/passwd的影子文件,密码存放在该文件当中,并且只有root用户可读              #</span><br><span class="line">###############################################################################################<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>检查重要日志文件是否存在:<span class="string">&quot;</span></span><br><span class="line"><span class="string">log_secure=/var/log/secure</span></span><br><span class="line"><span class="string">log_messages=/var/log/messages</span></span><br><span class="line"><span class="string">log_cron=/var/log/cron</span></span><br><span class="line"><span class="string">log_boot=/var/log/boot.log</span></span><br><span class="line"><span class="string">log_dmesg=/var/log/dmesg</span></span><br><span class="line"><span class="string">if [ -e &quot;</span>$log_secure<span class="string">&quot; ]; then</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/secure日志文件存在<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/secure日志文件不存在------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">if [ -e &quot;</span>$log_messages<span class="string">&quot; ]; then</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/messages日志文件存在<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/messages日志文件不存在------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">if [ -e &quot;</span>$log_cron<span class="string">&quot; ]; then</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/cron日志文件存在<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/cron日志文件不存在--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">if [ -e &quot;</span>$log_boot<span class="string">&quot; ]; then</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/boot.<span class="property">log</span>日志文件存在<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/boot.<span class="property">log</span>日志文件不存在--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">if [ -e &quot;</span>$log_dmesg<span class="string">&quot; ]; then</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/dmesg日志文件存在<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo  &quot;</span>&gt;&gt;&gt;<span class="regexp">/var/</span>log/dmesg日志文件不存在--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;剩余信息保护&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>分区情况:<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>如果磁盘空间利用率过高，请及时调整---------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">df -h</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>可用块设备信息:<span class="string">&quot;</span></span><br><span class="line"><span class="string">lsblk</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>文件系统信息:<span class="string">&quot;</span></span><br><span class="line"><span class="string">more /etc/fstab  | grep -v &quot;</span>^#<span class="string">&quot; | grep -v &quot;</span>^$<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;入侵防范安全&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>系统入侵行为:<span class="string">&quot;</span></span><br><span class="line"><span class="string">more /var/log/secure |grep refused</span></span><br><span class="line"><span class="string">if [ $? == 0 ];then</span></span><br><span class="line"><span class="string">    echo &quot;</span>有入侵行为，请分析处理--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;无入侵行为<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>用户错误登入列表:<span class="string">&quot;</span></span><br><span class="line"><span class="string">lastb | head &gt; /dev/null</span></span><br><span class="line"><span class="string">if [ $? == 1 ];then</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;无用户错误登入列表<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;用户错误登入--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">    lastb | head </span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>ssh暴力登入信息:<span class="string">&quot;</span></span><br><span class="line"><span class="string">more /var/log/secure | grep  &quot;</span><span class="title class_">Failed</span><span class="string">&quot; &gt; /dev/null</span></span><br><span class="line"><span class="string">if [ $? == 1 ];then</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;无ssh暴力登入信息<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">    more /var/log/secure|awk &#x27;/Failed/&#123;print $(NF-3)&#125;&#x27;|sort|uniq -c|awk &#x27;&#123;print &quot;</span>&gt;&gt;&gt;登入失败的<span class="variable constant_">IP</span>和尝试次数: <span class="string">&quot;$2&quot;</span>=<span class="string">&quot;$1&quot;</span>次---------[需调整]<span class="string">&quot;;&#125;&#x27;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;恶意代码防范&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>检查是否安装病毒软件:<span class="string">&quot;</span></span><br><span class="line"><span class="string">crontab -l | grep clamscan.sh &gt; /dev/null</span></span><br><span class="line"><span class="string">if [ $? == 0 ];then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;已安装<span class="title class_">ClamAV</span>杀毒软件<span class="string">&quot;</span></span><br><span class="line"><span class="string">  crontab -l | grep freshclam.sh &gt; /dev/null</span></span><br><span class="line"><span class="string">  if [ $? == 0 ];then</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;已部署定时更新病毒库<span class="string">&quot;</span></span><br><span class="line"><span class="string">  fi</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;未安装<span class="title class_">ClamAV</span>杀毒软件,请部署杀毒软件加固主机防护--------[无需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;资源控制安全&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>查看是否开启了xinetd服务:<span class="string">&quot;</span></span><br><span class="line"><span class="string">if ps -elf |grep xinet |grep -v &quot;</span>grep xinet<span class="string">&quot;;then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;xinetd服务正在运行，请检查是否可以把xinetd服务关闭--------[无需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;xinetd服务未开启-------[无需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>查看是否开启了ssh服务:<span class="string">&quot;</span></span><br><span class="line"><span class="string">if service sshd status | grep -E &quot;</span>listening on|active \(running\)<span class="string">&quot;; then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;<span class="variable constant_">SSH</span>服务已开启<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;<span class="variable constant_">SSH</span>服务未开启--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>查看是否开启了<span class="title class_">Telnet</span>-<span class="title class_">Server</span>服务:<span class="string">&quot;</span></span><br><span class="line"><span class="string">if more /etc/xinetd.d/telnetd 2&gt;&amp;1|grep -E &quot;</span>disable=no<span class="string">&quot;; then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;<span class="title class_">Telnet</span>-<span class="title class_">Server</span>服务已开启<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;<span class="title class_">Telnet</span>-<span class="title class_">Server</span>服务未开启--------[无需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">ps axu | grep iptables | grep -v grep || ps axu | grep firewalld | grep -v grep </span></span><br><span class="line"><span class="string">if [ $? == 0 ];then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;防火墙已启用<span class="string">&quot;</span></span><br><span class="line"><span class="string">iptables -nvL --line-numbers</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;防火墙未启用--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo  &quot;</span>查看系统<span class="variable constant_">SSH</span>远程访问设置策略(host.<span class="property">deny</span>拒绝列表):<span class="string">&quot;</span></span><br><span class="line"><span class="string">if more /etc/hosts.deny | grep -E &quot;</span>sshd<span class="string">&quot;; then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;远程访问策略已设置--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;远程访问策略未设置--------[无需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>查看系统<span class="variable constant_">SSH</span>远程访问设置策略(hosts.<span class="property">allow</span>允许列表):<span class="string">&quot;</span></span><br><span class="line"><span class="string">if more /etc/hosts.allow | grep -E &quot;</span>sshd<span class="string">&quot;; then</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;远程访问策略已设置--------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">  echo &quot;</span>&gt;&gt;&gt;远程访问策略未设置--------[无需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>当hosts.<span class="property">allow</span>和host.<span class="property">deny</span>相冲突时,以hosts.<span class="property">allow</span>设置为准<span class="string">&quot;</span></span><br><span class="line"><span class="string">echo &quot;</span>=============================dividing line================================<span class="string">&quot;</span></span><br><span class="line"><span class="string">grep -i &quot;</span><span class="variable constant_">TMOUT</span><span class="string">&quot; /etc/profile /etc/bashrc</span></span><br><span class="line"><span class="string">if [ $? == 0 ];then</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;已设置登入超时限制<span class="string">&quot;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">    echo &quot;</span>&gt;&gt;&gt;未设置登入超时限制,请设置,设置方法:在/etc/profile或者/etc/bashrc里面添加参数<span class="variable constant_">TMOUT</span>=<span class="number">600</span> --------[需调整]<span class="string">&quot;</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">echo &quot;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;end&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="二-主机初始化脚本"><a href="#二-主机初始化脚本" class="headerlink" title="[二] 主机初始化脚本"></a>[二] 主机初始化脚本</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env bash</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">PATH</span>=<span class="regexp">/usr/</span>local/<span class="attr">sbin</span>:<span class="regexp">/usr/</span>local/<span class="attr">bin</span>:<span class="regexp">/sbin:/</span><span class="attr">bin</span>:<span class="regexp">/usr/</span><span class="attr">sbin</span>:<span class="regexp">/usr/</span><span class="attr">bin</span>:<span class="regexp">/root/</span>bin</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">RGB_DANGER</span>=<span class="string">&#x27;\033[31;1m&#x27;</span></span><br><span class="line"><span class="variable constant_">RGB_WAIT</span>=<span class="string">&#x27;\033[37;2m&#x27;</span></span><br><span class="line"><span class="variable constant_">RGB_SUCCESS</span>=<span class="string">&#x27;\033[32m&#x27;</span></span><br><span class="line"><span class="variable constant_">RGB_WARNING</span>=<span class="string">&#x27;\033[33;1m&#x27;</span></span><br><span class="line"><span class="variable constant_">RGB_INFO</span>=<span class="string">&#x27;\033[36;1m&#x27;</span></span><br><span class="line"><span class="variable constant_">RGB_END</span>=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">CHECK_CENTOS</span>=$( cat /etc/redhat-release|sed -r <span class="string">&#x27;s/.* ([0-9]+)\..*/\1/&#x27;</span> )</span><br><span class="line"><span class="variable constant_">CHECK_RAM</span>=$( cat /proc/meminfo | grep <span class="string">&quot;MemTotal&quot;</span> | awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;ram=$2/1000000&#125;&#123;printf(&quot;%.0f&quot;,ram)&#125;&#x27;</span> )</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">LOCK</span>=<span class="regexp">/var/</span>log/init_centos7_record.<span class="property">log</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">tool_info</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo -e <span class="string">&quot;=========================================================================================&quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;                              Init CentOS 7 Script                                       &quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;=========================================================================================&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">check_root</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> [[ $EUID -ne <span class="number">0</span> ]]; then</span><br><span class="line">        echo -e <span class="string">&quot;$&#123;RGB_DANGER&#125;This script must be run as root!$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">        exit <span class="number">1</span></span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">check_lock</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> [ ! -f <span class="string">&quot;$LOCK&quot;</span> ];then</span><br><span class="line">        touch $LOCK</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        echo -e <span class="string">&quot;$&#123;RGB_DANGER&#125;Detects that the initialization is complete and does not need to be initialized any further!$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">        exit <span class="number">1</span></span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">check_os</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;$&#123;CHECK_CENTOS&#125;&quot;</span> != <span class="string">&#x27;7&#x27;</span> ]; then</span><br><span class="line">        echo -e <span class="string">&quot;$&#123;RGB_DANGER&#125;This script must be run in CentOS 7!$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">        exit <span class="number">1</span></span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">remote_login</span>(<span class="params"></span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;\033[1;31m	   4、Set Remote Login Configuration(SSH)	\033[0m&quot;</span></span><br><span class="line">    echo <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">#set <span class="title class_">Protocol</span> <span class="number">2</span></span><br><span class="line">    echo &gt;&gt; <span class="regexp">/etc/</span>ssh/sshd_config</span><br><span class="line">    grep -i <span class="string">&#x27;^Protocol&#x27;</span> /etc/ssh/sshd_config &gt; <span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> [ $? == <span class="number">0</span> ];then</span><br><span class="line">        sed -i <span class="string">&#x27;s/^Protocol.*$/Protocol 2/g&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">        <span class="keyword">if</span> [ $? != <span class="number">0</span> ];then</span><br><span class="line">            echo -e <span class="string">&quot;\033[31;5m	    [##Error##]: Cannot to set Protocol to &#x27;2&#x27;	    \033[0m&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            echo -e <span class="string">&quot;\033[37;5m	    [Success: Set SSH Protocol to 2]	    \033[0m&quot;</span></span><br><span class="line">         fi</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        echo <span class="string">&#x27;Protocol 2&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>ssh/sshd_config</span><br><span class="line">        echo -e <span class="string">&quot;\033[37;5m	    [Success: Set SSH Protocol to 2]	    \033[0m&quot;</span></span><br><span class="line">    fi</span><br><span class="line">    </span><br><span class="line">	grep -i <span class="string">&#x27;^PermitRootLogin no&#x27;</span> /etc/ssh/sshd_config &gt; <span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">	<span class="keyword">if</span> [ $? == <span class="number">1</span> ];then</span><br><span class="line">            grep -i <span class="string">&#x27;.*PermitRootLogin yes&#x27;</span> /etc/ssh/sshd_config &gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">            <span class="keyword">if</span> [ $? == <span class="number">0</span> ];then</span><br><span class="line">                sed -i <span class="string">&#x27;s/.*PermitRootLogin yes/PermitRootLogin no/g&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">                <span class="keyword">if</span> [ $? != <span class="number">0</span> ];then</span><br><span class="line">                    echo -e <span class="string">&quot;\033[31;5m	[##Error##]cannot to set PermitRootLogin to &#x27;no&#x27;	\033[0m&quot;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">        	    echo -e <span class="string">&quot;\033[37;5m	    Disable root remote login[Success]	    \033[0m&quot;</span></span><br><span class="line">        	    restart_flag=<span class="number">0</span></span><br><span class="line">                fi</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                echo <span class="string">&#x27;PermitRootLogin no&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>ssh/sshd_config</span><br><span class="line">        	echo -e <span class="string">&quot;\033[37;5m	    Disable root remote login[Success]	    \033[0m&quot;</span></span><br><span class="line">                restart_flag=<span class="number">0</span></span><br><span class="line">            fi</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	    echo -e <span class="string">&quot;\033[37;5m	    Already disable root remote login	\033[0m&quot;</span></span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">create_user</span>(<span class="params"></span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;\033[1;31m	   3、Create openroot account	\033[0m&quot;</span></span><br><span class="line">    echo <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    read -p <span class="string">&quot;Be sure to create an openroot account?[y/n]:&quot;</span></span><br><span class="line">    <span class="keyword">case</span> $REPLY <span class="keyword">in</span> </span><br><span class="line">    y)</span><br><span class="line">	grep -i <span class="string">&#x27;openroot&#x27;</span> /etc/passwd</span><br><span class="line">        <span class="keyword">if</span> [ $? == <span class="number">0</span> ];then</span><br><span class="line">	    echo -e <span class="string">&quot;\033[1;31m		An openroot account has been created	\033[0m&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">	    read -p <span class="string">&quot;Please enter your password:&quot;</span> <span class="variable constant_">PASSWD</span></span><br><span class="line">	    useradd -g root openroot;echo <span class="string">&quot;$PASSWD&quot;</span> | passwd --stdin openroot  &gt; <span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">	    <span class="keyword">if</span> [ $? == <span class="number">0</span> ];then</span><br><span class="line">		echo -e <span class="string">&quot;\033[1;31m	openroot account created successfully	    \033[0m&quot;</span></span><br><span class="line">		grep -i <span class="string">&quot;openroot&quot;</span> /etc/sudoers</span><br><span class="line">		<span class="keyword">if</span> [ $? != <span class="number">0</span> ];then</span><br><span class="line">		    chmod u+w /etc/sudoers &gt; <span class="regexp">/dev/</span><span class="literal">null</span> </span><br><span class="line">		    sed -i <span class="string">&#x27;/^root.*ALL=(ALL).*$/a\openroot  ALL=(ALL)       NOPASSWD:ALL&#x27;</span> /etc/sudoers &gt; <span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">		    <span class="keyword">if</span> [ $? == <span class="number">0</span> ];then</span><br><span class="line">			echo -e <span class="string">&quot;\033[37;5m	    [Permissions set success]	\033[0m&quot;</span></span><br><span class="line">		    <span class="keyword">else</span></span><br><span class="line">			echo -e <span class="string">&quot;\033[31;5m	    [Permissions set failed]	\033[0m&quot;</span></span><br><span class="line">		    fi</span><br><span class="line">		    chmod u-w /etc/sudoers &gt; <span class="regexp">/dev/</span><span class="literal">null</span> </span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		    echo -e <span class="string">&quot;\033[1;31m	    Permissions have already been set	    \033[0m&quot;</span></span><br><span class="line">		fi</span><br><span class="line">	    <span class="keyword">else</span></span><br><span class="line">		echo -e <span class="string">&quot;\033[1;31m	    openroot account created failed	    \033[0m&quot;</span></span><br><span class="line">		exit <span class="number">1</span> </span><br><span class="line">	    fi</span><br><span class="line">	fi</span><br><span class="line">	;;</span><br><span class="line">    n)</span><br><span class="line">	;;</span><br><span class="line">    *)</span><br><span class="line">	create_user</span><br><span class="line">    esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###########################文件备份############################</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">backup</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">if</span> [ ! -x <span class="string">&quot;backup&quot;</span> ]; then</span><br><span class="line">    mkdir backup</span><br><span class="line">    <span class="keyword">if</span> [ -f /etc/pam.<span class="property">d</span>/system-auth ];then</span><br><span class="line">        cp /etc/pam.<span class="property">d</span>/system-auth backup/system-auth.<span class="property">bak</span></span><br><span class="line">    elif [ -f /etc/pam.<span class="property">d</span>/common-password ];then</span><br><span class="line">        cp /etc/pam.<span class="property">d</span>/common-password backup/common-password.<span class="property">bak</span></span><br><span class="line">    fi</span><br><span class="line">    <span class="keyword">if</span> [ -f ~<span class="regexp">/.ssh/</span>authorized_keys ];then</span><br><span class="line">        cp ~<span class="regexp">/.ssh/</span>authorized_keys backup/authorized_keys.<span class="property">bak</span></span><br><span class="line">    fi</span><br><span class="line">    cp /etc/pam.<span class="property">d</span>/sshd backup/sshd.<span class="property">bak</span></span><br><span class="line">    cp /etc/sudoers backup/sudoers.<span class="property">bak</span></span><br><span class="line">    cp /etc/ssh/sshd_config backup/sshd_config.<span class="property">bak</span></span><br><span class="line">    cp /etc/profile backup/profile.<span class="property">bak</span></span><br><span class="line">    cp /etc/pam.<span class="property">d</span>/su backup/su.<span class="property">bak</span></span><br><span class="line">    cp /etc/security/limits.<span class="property">conf</span> backup/limits.<span class="property">conf</span>.<span class="property">bak</span></span><br><span class="line">    cp /etc/sysctl.<span class="property">conf</span>  backup/sysctl.<span class="property">conf</span>.<span class="property">bak</span></span><br><span class="line">    cp /etc/login.<span class="property">defs</span> backup/login.<span class="property">defs</span>.<span class="property">bak</span></span><br><span class="line">    echo -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;\033[1;31m     Auto backup successfully        \033[0m&quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    echo -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;\033[1;31mBackup file already exist, to avoid overwriting these files, backup will not perform again\033[0m &quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;###########################################################################################&quot;</span></span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line">###########################执行备份############################</span><br><span class="line"></span><br><span class="line">###########################文件还原############################</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">recover</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">if</span> [ -f backup/system-auth.<span class="property">bak</span> ];then</span><br><span class="line">    cp -rf backup/system-auth.<span class="property">bak</span> /etc/pam.<span class="property">d</span>/system-auth</span><br><span class="line">elif [ -f backup/common-password.<span class="property">bak</span> ];then</span><br><span class="line">    cp -rf backup/common-password.<span class="property">bak</span> /etc/pam.<span class="property">d</span>/common-password</span><br><span class="line">fi</span><br><span class="line"><span class="keyword">if</span> [ -f backup/authorized_keys.<span class="property">bak</span> ];then</span><br><span class="line">    cp -rf backup/authorized_keys.<span class="property">bak</span> ~<span class="regexp">/.ssh/</span>authorized_keys</span><br><span class="line">fi</span><br><span class="line">    cp -rf backup/sshd.<span class="property">bak</span> /etc/pam.<span class="property">d</span>/sshd</span><br><span class="line">    cp -rf backup/sudoers.<span class="property">bak</span> /etc/sudoers</span><br><span class="line">    cp -rf backup/sshd_config.<span class="property">bak</span> /etc/ssh/sshd_config</span><br><span class="line">    cp -rf backup/profile.<span class="property">bak</span> /etc/profile</span><br><span class="line">    cp -rf backup/limits.<span class="property">conf</span>.<span class="property">bak</span> /etc/security/limits.<span class="property">conf</span></span><br><span class="line">    cp -rf backup/sysctl.<span class="property">conf</span>.<span class="property">bak</span> /etc/sysctl.<span class="property">conf</span> </span><br><span class="line">    cp -rf backup/login.<span class="property">defs</span>.<span class="property">bak</span> /etc/login.<span class="property">defs</span></span><br><span class="line">    source /etc/profile</span><br><span class="line">    cp -rf backup/su.<span class="property">bak</span> /etc/pam.<span class="property">d</span>/su</span><br><span class="line">    restart_flag=<span class="number">0</span></span><br><span class="line">    echo -e <span class="string">&quot;\033[1;31m    8、 Recover success  \033[0m&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">new_swap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= swap =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;$&#123;CHECK_RAM&#125;&quot;</span> -le <span class="string">&#x27;2&#x27;</span> ]; then</span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>zero <span class="keyword">of</span>=/swapfile bs=<span class="number">1024</span> count=<span class="number">1048576</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    chmod <span class="number">600</span> /swapfile &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    mkswap /swapfile &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    swapon /swapfile &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo <span class="string">&#x27;/swapfile swap swap defaults 0 0&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>fstab</span><br><span class="line">    echo <span class="string">&#x27;# Swap&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    echo <span class="string">&#x27;vm.swappiness = 10&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    sysctl -p &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    sysctl -n vm.<span class="property">swappiness</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    echo -e <span class="string">&quot;$&#123;RGB_SUCCESS&#125;Skip, no configuration needed$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">open_bbr</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= bbr =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    echo <span class="string">&quot;# BBR&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    echo <span class="string">&quot;net.core.default_qdisc=fq&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    echo <span class="string">&quot;net.ipv4.tcp_congestion_control=bbr&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    sysctl -p &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    sysctl -n net.<span class="property">ipv4</span>.<span class="property">tcp_congestion_control</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    lsmod | grep bbr &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">disable_software</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= selinux firewalld =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    setenforce <span class="number">0</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    sed -i <span class="string">&#x27;s/^SELINUX=.*$/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br><span class="line">    systemctl disable firewalld.<span class="property">service</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"> systemctl stop firewalld.<span class="property">service</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">time_zone</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= time zone =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    rm -rf /etc/localtime &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    ln -sf /usr/share/zoneinfo/<span class="title class_">Asia</span>/<span class="title class_">Shanghai</span> /etc/localtime &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    ls -ln /etc/localtime &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">custom_profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= custom profile =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    cat &gt; <span class="regexp">/etc/</span>profile.<span class="property">d</span>/centos7init.<span class="property">sh</span> &lt;&lt; <span class="variable constant_">EOF</span></span><br><span class="line"><span class="title class_">PS1</span>=<span class="string">&quot;\[\e[37;40m\][\[\e[32;40m\]\u\[\e[37;40m\]@\h \[\e[35;40m\]\W\[\e[0m\]]\\\\$ &quot;</span></span><br><span class="line"><span class="variable constant_">GREP_OPTIONS</span>=<span class="string">&quot;--color=auto&quot;</span></span><br><span class="line">alias l=<span class="string">&#x27;ls -AFhlt&#x27;</span></span><br><span class="line">alias grep=<span class="string">&#x27;grep --color&#x27;</span></span><br><span class="line">alias egrep=<span class="string">&#x27;egrep --color&#x27;</span></span><br><span class="line">alias fgrep=<span class="string">&#x27;fgrep --color&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">HISTTIMEFORMAT</span>=<span class="string">&quot;%Y-%m-%d %H:%M:%S  &quot;</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line">    cat /etc/profile.<span class="property">d</span>/centos7init.<span class="property">sh</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">adjust_ulimit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= adjust ulimit =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    sed -i <span class="string">&#x27;/^# End of file/,$d&#x27;</span> /etc/security/limits.<span class="property">conf</span></span><br><span class="line">    cat &gt;&gt; <span class="regexp">/etc/</span>security/limits.<span class="property">conf</span> &lt;&lt;<span class="variable constant_">EOF</span></span><br><span class="line"># <span class="title class_">End</span> <span class="keyword">of</span> file</span><br><span class="line">* soft core unlimited</span><br><span class="line">* hard core unlimited</span><br><span class="line">* soft nproc <span class="number">1000000</span></span><br><span class="line">* hard nproc <span class="number">1000000</span></span><br><span class="line">* soft nofile <span class="number">1000000</span></span><br><span class="line">* hard nofile <span class="number">1000000</span></span><br><span class="line">root soft core unlimited</span><br><span class="line">root hard core unlimited</span><br><span class="line">root soft nproc <span class="number">1000000</span></span><br><span class="line">root hard nproc <span class="number">1000000</span></span><br><span class="line">root soft nofile <span class="number">1000000</span></span><br><span class="line">root hard nofile <span class="number">1000000</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line">    cat /etc/security/limits.<span class="property">conf</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">kernel_optimum</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= kernel optimum =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    [ ! -e <span class="string">&quot;/etc/sysctl.conf_bak&quot;</span> ] &amp;&amp; <span class="regexp">/bin/m</span>v /etc/sysctl.<span class="property">conf</span>&#123;,_bak&#125;</span><br><span class="line">    cat &gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span> &lt;&lt; <span class="variable constant_">EOF</span></span><br><span class="line"># <span class="title class_">Controls</span> source route verification</span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">default</span>.<span class="property">rp_filter</span> = <span class="number">1</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">ip_nonlocal_bind</span> = <span class="number">1</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">ip_forward</span> = <span class="number">0</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">all</span>.<span class="property">accept_redirects</span> = <span class="number">0</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">all</span>.<span class="property">accept_source_route</span> = <span class="number">0</span> </span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">default</span>.<span class="property">accept_source_route</span> = <span class="number">0</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">icmp_echo_ignore_broadcasts</span> = <span class="number">1</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">all</span>.<span class="property">log_martians</span> = <span class="number">1</span> </span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">default</span>.<span class="property">log_martians</span> = <span class="number">1</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">all</span>.<span class="property">promote_secondaries</span> = <span class="number">1</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">default</span>.<span class="property">promote_secondaries</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Controls</span> the use <span class="keyword">of</span> <span class="variable constant_">TCP</span> syncookies</span><br><span class="line"># <span class="title class_">Number</span> <span class="keyword">of</span> pid_max</span><br><span class="line">kernel.<span class="property">core_uses_pid</span> = <span class="number">1</span></span><br><span class="line">kernel.<span class="property">pid_max</span> = <span class="number">1000000</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_syncookies</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Controls</span> the maximum size <span class="keyword">of</span> a message, <span class="keyword">in</span> bytes</span><br><span class="line"># <span class="title class_">Controls</span> the <span class="keyword">default</span> maxmimum size <span class="keyword">of</span> a mesage queue</span><br><span class="line"># <span class="title class_">Controls</span> the maximum shared segment size, <span class="keyword">in</span> bytes</span><br><span class="line"># <span class="title class_">Controls</span> the maximum number <span class="keyword">of</span> shared memory segments, <span class="keyword">in</span> pages</span><br><span class="line">kernel.<span class="property">msgmnb</span> = <span class="number">65536</span></span><br><span class="line">kernel.<span class="property">msgmax</span> = <span class="number">65536</span></span><br><span class="line">kernel.<span class="property">shmmax</span> = <span class="number">68719476736</span></span><br><span class="line">kernel.<span class="property">shmall</span> = <span class="number">4294967296</span></span><br><span class="line">kernel.<span class="property">sysrq</span> = <span class="number">1</span></span><br><span class="line">kernel.<span class="property">softlockup_panic</span> = <span class="number">1</span></span><br><span class="line">kernel.<span class="property">printk</span> = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"># <span class="variable constant_">TCP</span> kernel paramater</span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_mem</span> = <span class="number">94500000</span> <span class="number">915000000</span> <span class="number">927000000</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_rmem</span> = <span class="number">4096</span> <span class="number">87380</span> <span class="number">4194304</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_wmem</span> = <span class="number">4096</span> <span class="number">16384</span> <span class="number">4194304</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_window_scaling</span> = <span class="number">1</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_sack</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Socket</span> buffer</span><br><span class="line">net.<span class="property">core</span>.<span class="property">wmem_default</span> = <span class="number">8388608</span></span><br><span class="line">net.<span class="property">core</span>.<span class="property">rmem_default</span> = <span class="number">8388608</span></span><br><span class="line">net.<span class="property">core</span>.<span class="property">rmem_max</span> = <span class="number">16777216</span></span><br><span class="line">net.<span class="property">core</span>.<span class="property">wmem_max</span> = <span class="number">16777216</span></span><br><span class="line">net.<span class="property">core</span>.<span class="property">netdev_max_backlog</span> = <span class="number">32768</span></span><br><span class="line">net.<span class="property">core</span>.<span class="property">somaxconn</span> = <span class="number">65535</span></span><br><span class="line">net.<span class="property">core</span>.<span class="property">optmem_max</span> = <span class="number">81920</span></span><br><span class="line"></span><br><span class="line"># <span class="variable constant_">TCP</span> conn</span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_max_syn_backlog</span> = <span class="number">262144</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_syn_retries</span> = <span class="number">1</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_retries1</span> = <span class="number">3</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_retries2</span> = <span class="number">15</span></span><br><span class="line"></span><br><span class="line"># <span class="variable constant_">TCP</span> conn reuse</span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_timestamps</span> = <span class="number">0</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_tw_reuse</span> = <span class="number">1</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_fin_timeout</span> = <span class="number">5</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_max_tw_buckets</span> = <span class="number">7000</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_max_orphans</span> = <span class="number">3276800</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_synack_retries</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># keepalive conn</span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_keepalive_time</span> = <span class="number">300</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_keepalive_intvl</span> = <span class="number">30</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">tcp_keepalive_probes</span> = <span class="number">3</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">ip_local_port_range</span> = <span class="number">1024</span> <span class="number">65535</span></span><br><span class="line"></span><br><span class="line">net.<span class="property">ipv6</span>.<span class="property">neigh</span>.<span class="property">default</span>.<span class="property">gc_thresh3</span> = <span class="number">4096</span></span><br><span class="line">net.<span class="property">ipv4</span>.<span class="property">neigh</span>.<span class="property">default</span>.<span class="property">gc_thresh3</span> = <span class="number">4096</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line">    sysctl -p &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    cat /etc/sysctl.<span class="property">conf</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">updatedb_optimum</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= updatedb optimum =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    sed -i <span class="string">&#x27;s,media,media /data,&#x27;</span> /etc/updatedb.<span class="property">conf</span></span><br><span class="line">    cat /etc/updatedb.<span class="property">conf</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">open_ipv6</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= open ipv6 =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    echo <span class="string">&#x27;# IPV6&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    echo <span class="string">&#x27;net.ipv6.conf.all.disable_ipv6=0&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    echo <span class="string">&#x27;net.ipv6.conf.default.disable_ipv6=0&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    echo <span class="string">&#x27;net.ipv6.conf.lo.disable_ipv6=0&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.<span class="property">conf</span></span><br><span class="line">    sysctl -p &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    cat /etc/sysctl.<span class="property">conf</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">disable_cad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= disable cad =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    systemctl mask ctrl-alt-del.<span class="property">target</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">remove_users</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= remove users =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> adm lp sync shutdown halt mail operator games ftp </span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    userdel $&#123;u&#125; &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    done</span><br><span class="line">    cut -d : -f <span class="number">1</span> /etc/passwd &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> adm lp mail games ftp </span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    groupdel $&#123;g&#125; &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    done</span><br><span class="line">    cat /etc/group &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sys_permissions</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= sys permissions =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    chmod <span class="number">644</span> /etc/passwd &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    chmod <span class="number">644</span> /etc/group &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    chmod <span class="number">000</span> /etc/shadow &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    chmod <span class="number">000</span> /etc/gshadow &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    ls -la /etc/passwd &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    ls -la /etc/group &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    ls -la /etc/shadow &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    ls -la /etc/gshadow &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">password_policy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= password policy =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    sed -i <span class="string">&#x27;s/^PASS_MAX_DAYS.*$/PASS_MAX_DAYS   90/&#x27;</span> /etc/login.<span class="property">defs</span></span><br><span class="line">    sed -i <span class="string">&#x27;s/^PASS_MIN_DAYS.*$/PASS_MIN_DAYS   10/&#x27;</span> /etc/login.<span class="property">defs</span></span><br><span class="line">    cat /etc/login.<span class="property">defs</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    cat &gt;&gt;<span class="regexp">/etc/</span>security/pwquality.<span class="property">conf</span> &lt;&lt; <span class="variable constant_">EOF</span></span><br><span class="line">minlen = <span class="number">8</span> </span><br><span class="line">dcredit = -<span class="number">1</span></span><br><span class="line">ucredit = -<span class="number">1</span></span><br><span class="line">ocredit = -<span class="number">1</span></span><br><span class="line">lcredit = -<span class="number">1</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">change_useradd</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= change useradd =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    sed -i <span class="string">&#x27;s/^INACTIVE.*$/INACTIVE=180/&#x27;</span> /etc/<span class="keyword">default</span>/useradd</span><br><span class="line">    cat /etc/<span class="keyword">default</span>/useradd &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sec_ssh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= sec ssh =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    sed -i <span class="string">&#x27;s/UseDNS.*$/UseDNS no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    sed -i <span class="string">&#x27;s/^#LoginGraceTime.*$/LoginGraceTime 60/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    sed -i <span class="string">&#x27;s/^#PermitEmptyPasswords.*$/PermitEmptyPasswords no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    sed -i <span class="string">&#x27;s/^#PubkeyAuthentication.*$/PubkeyAuthentication yes/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    sed -i <span class="string">&#x27;s/^#MaxAuthTries.*$/MaxAuthTries 3/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">    sed -i <span class="string">&quot;s/#ClientAliveInterval 0/ClientAliveInterval 300/g&quot;</span> /etc/ssh/sshd_config </span><br><span class="line">    sed -i <span class="string">&quot;s/#ClientAliveCountMax 3/ClientAliveCountMax 3/g&quot;</span> /etc/ssh/sshd_config</span><br><span class="line">    sed -i <span class="string">&quot;s/X11Forwarding yes/X11Forwarding no/g&quot;</span> /etc/ssh/sshd_config</span><br><span class="line">    sed -i <span class="string">&quot;s/#Banner none/Banner \/etc\/issue.net/g&quot;</span> /etc/ssh/sshd_config</span><br><span class="line">    echo <span class="string">&quot;Authorized users only. All activity may be monitored and reported.&quot;</span>&gt;<span class="regexp">/etc/i</span>ssue.<span class="property">net</span></span><br><span class="line">    systemctl restart sshd.<span class="property">service</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    cat /etc/ssh/sshd_config &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">timeout_config</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= timeout config =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    echo <span class="string">&quot;export TMOUT=1800&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>profile.<span class="property">d</span>/centos7init.<span class="property">sh</span></span><br><span class="line">    cat /etc/profile.<span class="property">d</span>/centos7init.<span class="property">sh</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#######################配置系统历史命令操作记录和定时帐户自动登出时间################################</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">set_history_tmout</span>(<span class="params"></span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line">    echo -e <span class="string">&quot;\033[1;31m	    5、set history and timeout	\033[0m&quot;</span></span><br><span class="line">    echo <span class="string">&quot;#########################################################################################&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	#history_size</span><br><span class="line">        grep -i <span class="string">&quot;^HISTSIZE=&quot;</span> /etc/profile &gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">        <span class="keyword">if</span> [ $? == <span class="number">0</span> ];then</span><br><span class="line">	#history记录保留一万条</span><br><span class="line">            sed -i <span class="string">&quot;s/^HISTSIZE=.*$/HISTSIZE=10000/g&quot;</span> /etc/profile</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            echo <span class="string">&#x27;HISTSIZE=10000&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>profile</span><br><span class="line">        fi</span><br><span class="line">        echo -e <span class="string">&quot;\033[1;31m	    HISTSIZE has been set to 10000	    \033[0m&quot;</span></span><br><span class="line">	#history_format</span><br><span class="line">        grep -i <span class="string">&quot;^export HISTTIMEFORMAT=&quot;</span> /etc/profile &gt; <span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">        <span class="keyword">if</span> [ $? == <span class="number">0</span> ];then</span><br><span class="line">            sed -i <span class="string">&#x27;s/^export HISTTIMEFORMAT=.*$/export HISTTIMEFORMAT=&quot;%F %T `whoami`&quot;/g&#x27;</span> /etc/profile</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            echo <span class="string">&#x27;export HISTTIMEFORMAT=&quot;%F %T `whoami` &quot;&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>profile</span><br><span class="line">        fi</span><br><span class="line">        echo -e <span class="string">&#x27;\033[1;31m	    HISTTIMEFORMAT has been set to &quot;Number-Time-User-Command&quot;	    \033[0m&#x27;</span></span><br><span class="line">	#<span class="variable constant_">TIME_OUT</span></span><br><span class="line">        #read -p <span class="string">&quot;set shell TMOUT?[300-600]seconds:&quot;</span> tmout </span><br><span class="line">	#: $&#123;<span class="attr">tmout</span>:=<span class="number">600</span>&#125;</span><br><span class="line">        grep -i <span class="string">&quot;^TMOUT=&quot;</span> /etc/profile	&gt; <span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">        <span class="keyword">if</span> [ $? == <span class="number">0</span> ];then</span><br><span class="line">            sed -i <span class="string">&quot;s/^TMOUT=.*$/TMOUT=600/g&quot;</span> /etc/profile</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            echo <span class="string">&quot;TMOUT=600&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>profile</span><br><span class="line">        fi</span><br><span class="line">        source /etc/profile</span><br><span class="line">	echo -e <span class="string">&quot;\033[37;5m	    [Success]	    \033[0m&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">lockout_policy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;============= lockout policy =============&quot;</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -en <span class="string">&quot;$&#123;RGB_WAIT&#125;Configuring...$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    [ ! -e <span class="string">&quot;/etc/pam.d/system-auth_bak&quot;</span> ] &amp;&amp; <span class="regexp">/bin/m</span>v /etc/pam.<span class="property">d</span>/system-auth&#123;,_bak&#125;</span><br><span class="line">    cat &gt; <span class="regexp">/etc/</span>pam.<span class="property">d</span>/system-auth &lt;&lt; <span class="variable constant_">EOF</span></span><br><span class="line">auth        required                                     pam_env.<span class="property">so</span></span><br><span class="line">auth        required                                     pam_faillock.<span class="property">so</span> preauth silent audit deny=<span class="number">3</span> unlock_time=<span class="number">900</span></span><br><span class="line">auth        required                                     pam_faildelay.<span class="property">so</span> delay=<span class="number">2000000</span></span><br><span class="line">auth        [<span class="keyword">default</span>=<span class="number">1</span> ignore=ignore success=ok]         pam_succeed_if.<span class="property">so</span> uid &gt;= <span class="number">1000</span> quiet</span><br><span class="line">auth        [<span class="keyword">default</span>=<span class="number">1</span> ignore=ignore success=ok]         pam_localuser.<span class="property">so</span></span><br><span class="line">auth        sufficient                                   pam_unix.<span class="property">so</span> nullok try_first_pass</span><br><span class="line">auth        [<span class="keyword">default</span>=die]                                pam_faillock.<span class="property">so</span>  authfail  audit  deny=<span class="number">3</span>  unlock_time=<span class="number">900</span></span><br><span class="line">auth        requisite                                    pam_succeed_if.<span class="property">so</span> uid &gt;= <span class="number">1000</span> quiet_success</span><br><span class="line">auth        sufficient                                   pam_sss.<span class="property">so</span> forward_pass</span><br><span class="line">auth        required                                     pam_deny.<span class="property">so</span></span><br><span class="line"></span><br><span class="line">account     required                                     pam_unix.<span class="property">so</span></span><br><span class="line">account     sufficient                                   pam_localuser.<span class="property">so</span></span><br><span class="line">account     sufficient                                   pam_succeed_if.<span class="property">so</span> uid &lt; <span class="number">1000</span> quiet</span><br><span class="line">account     [<span class="keyword">default</span>=bad success=ok user_unknown=ignore] pam_sss.<span class="property">so</span></span><br><span class="line">account     required                                     pam_permit.<span class="property">so</span></span><br><span class="line">account     required                                     pam_faillock.<span class="property">so</span></span><br><span class="line"></span><br><span class="line">password    requisite                                    pam_pwquality.<span class="property">so</span> try_first_pass local_users_only</span><br><span class="line">password    sufficient                                   pam_unix.<span class="property">so</span> sha512 shadow nullok try_first_pass use_authtok</span><br><span class="line">password    sufficient                                   pam_sss.<span class="property">so</span> use_authtok</span><br><span class="line">password    required                                     pam_deny.<span class="property">so</span></span><br><span class="line"></span><br><span class="line">session     optional                                     pam_keyinit.<span class="property">so</span> revoke</span><br><span class="line">session     required                                     pam_limits.<span class="property">so</span></span><br><span class="line">-session    optional                                     pam_systemd.<span class="property">so</span></span><br><span class="line">session     [success=<span class="number">1</span> <span class="keyword">default</span>=ignore]                   pam_succeed_if.<span class="property">so</span> service <span class="keyword">in</span> crond quiet use_uid</span><br><span class="line">session     required                                     pam_unix.<span class="property">so</span></span><br><span class="line">session     optional                                     pam_sss.<span class="property">so</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line">    [ ! -e <span class="string">&quot;/etc/pam.d/password-auth_bak&quot;</span> ] &amp;&amp; <span class="regexp">/bin/m</span>v /etc/pam.<span class="property">d</span>/password-auth&#123;,_bak&#125;</span><br><span class="line">    cat &gt; <span class="regexp">/etc/</span>pam.<span class="property">d</span>/password-auth &lt;&lt; <span class="variable constant_">EOF</span></span><br><span class="line">auth        required                                     pam_env.<span class="property">so</span></span><br><span class="line">auth        required                                     pam_faillock.<span class="property">so</span> preauth silent audit deny=<span class="number">3</span> unlock_time=<span class="number">900</span></span><br><span class="line">auth        required                                     pam_faildelay.<span class="property">so</span> delay=<span class="number">2000000</span></span><br><span class="line">auth        [<span class="keyword">default</span>=<span class="number">1</span> ignore=ignore success=ok]         pam_succeed_if.<span class="property">so</span> uid &gt;= <span class="number">1000</span> quiet</span><br><span class="line">auth        [<span class="keyword">default</span>=<span class="number">1</span> ignore=ignore success=ok]         pam_localuser.<span class="property">so</span></span><br><span class="line">auth        sufficient                                   pam_unix.<span class="property">so</span> nullok try_first_pass</span><br><span class="line">auth        [<span class="keyword">default</span>=die]                                pam_faillock.<span class="property">so</span>  authfail  audit  deny=<span class="number">3</span>  unlock_time=<span class="number">900</span></span><br><span class="line">auth        requisite                                    pam_succeed_if.<span class="property">so</span> uid &gt;= <span class="number">1000</span> quiet_success</span><br><span class="line">auth        sufficient                                   pam_sss.<span class="property">so</span> forward_pass</span><br><span class="line">auth        required                                     pam_deny.<span class="property">so</span></span><br><span class="line"></span><br><span class="line">account     required                                     pam_unix.<span class="property">so</span></span><br><span class="line">account     sufficient                                   pam_localuser.<span class="property">so</span></span><br><span class="line">account     sufficient                                   pam_succeed_if.<span class="property">so</span> uid &lt; <span class="number">1000</span> quiet</span><br><span class="line">account     [<span class="keyword">default</span>=bad success=ok user_unknown=ignore] pam_sss.<span class="property">so</span></span><br><span class="line">account     required                                     pam_permit.<span class="property">so</span></span><br><span class="line">account     required                                     pam_faillock.<span class="property">so</span></span><br><span class="line"></span><br><span class="line">password    requisite                                    pam_pwquality.<span class="property">so</span> try_first_pass local_users_only</span><br><span class="line">password    sufficient                                   pam_unix.<span class="property">so</span> sha512 shadow nullok try_first_pass use_authtok</span><br><span class="line">password    sufficient                                   pam_sss.<span class="property">so</span> use_authtok</span><br><span class="line">password    required                                     pam_deny.<span class="property">so</span></span><br><span class="line"></span><br><span class="line">session     optional                                     pam_keyinit.<span class="property">so</span> revoke</span><br><span class="line">session     required                                     pam_limits.<span class="property">so</span></span><br><span class="line">-session    optional                                     pam_systemd.<span class="property">so</span></span><br><span class="line">session     [success=<span class="number">1</span> <span class="keyword">default</span>=ignore]                   pam_succeed_if.<span class="property">so</span> service <span class="keyword">in</span> crond quiet use_uid</span><br><span class="line">session     required                                     pam_unix.<span class="property">so</span></span><br><span class="line">session     optional                                     pam_sss.<span class="property">so</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line">    systemctl restart sshd.<span class="property">service</span> &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    cat /etc/pam.<span class="property">d</span>/etc/pam.<span class="property">d</span>/system-auth &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    cat /etc/pam.<span class="property">d</span>/password-auth &gt;&gt; $&#123;<span class="variable constant_">LOCK</span>&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    echo -e <span class="string">&quot;\r$&#123;RGB_SUCCESS&#125;Configuration Success$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="title function_">reboot_os</span>(<span class="params"></span>) &#123;</span><br><span class="line">#    echo -e <span class="string">&quot;\n$&#123;RGB_WARNING&#125;Please restart the server and see if the services start up fine.$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">#    echo -en <span class="string">&quot;$&#123;RGB_WARNING&#125;Do you want to restart OS ? [y/n]: $&#123;RGB_END&#125;&quot;</span></span><br><span class="line">#    <span class="keyword">while</span> :; <span class="keyword">do</span></span><br><span class="line">#        read <span class="variable constant_">REBOOT_STATUS</span></span><br><span class="line">#        <span class="keyword">if</span> [[ ! <span class="string">&quot;$&#123;REBOOT_STATUS&#125;&quot;</span> =~ ^[y,n]$ ]]; then</span><br><span class="line">#            echo -en <span class="string">&quot;$&#123;RGB_DANGER&#125;Input error, please only input &#x27;y&#x27; or &#x27;n&#x27;: $&#123;RGB_END&#125;&quot;</span></span><br><span class="line">#        <span class="keyword">else</span></span><br><span class="line">#            <span class="keyword">break</span></span><br><span class="line">#        fi</span><br><span class="line">#    done</span><br><span class="line">#    [ <span class="string">&quot;$&#123;REBOOT_STATUS&#125;&quot;</span> == <span class="string">&#x27;y&#x27;</span> ] &amp;&amp; reboot</span><br><span class="line">#&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;1/18 : Start Init CentOS7 Script $&#123;RGB_END&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;2/18 : Customize the profile (color and alias)$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    custom_profile</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;3/18 : Time zone adjustment$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">#    time_zone</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;4/18 : Disable selinux and firewalld$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">#    disable_software</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;5/18 : Disable Ctrl+Alt+Del$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    disable_cad</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;6/18 : Kernel parameter optimization$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">   # kernel_optimum</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;7/18 : The updatedb optimization$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    updatedb_optimum</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;8/18 : Adding swap space$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">   # new_swap</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;9/18 : Adjustment of ulimit$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    adjust_ulimit</span><br><span class="line">    </span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;10/18 : Enable tcp bbr congestion control algorithm$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    #open_bbr</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;11/18 : Enable IPV6$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    #open_ipv6</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;12/18 : Remove unnecessary users and user groups from the system$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    remove_users</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;13/18 : System permissions for sensitive files$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    sys_permissions</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;14/18 : Modify Account Password Survival Policy$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    password_policy</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;15/18 : Maximum number of days an account is valid after password expiration strategy$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">#    change_useradd</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;16/18 : Secure configuration of SSH$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    sec_ssh</span><br><span class="line">    remote_login</span><br><span class="line">    #create_user</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;17/18 : Timeout Auto-Logout Configuration$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    #timeout_config</span><br><span class="line">    set_history_tmout</span><br><span class="line"></span><br><span class="line">    echo -e <span class="string">&quot;\n$&#123;RGB_INFO&#125;18/18 : Configure account login failure lockout policy$&#123;RGB_END&#125;&quot;</span></span><br><span class="line">    lockout_policy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#clear</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> $1 <span class="keyword">in</span></span><br><span class="line">     all)</span><br><span class="line">        backup</span><br><span class="line">	tool_info</span><br><span class="line">	check_root</span><br><span class="line">	check_os</span><br><span class="line">#	check_lock</span><br><span class="line">     	main</span><br><span class="line">      	 ;;</span><br><span class="line"></span><br><span class="line">     recover)</span><br><span class="line">     	 recover</span><br><span class="line">     	 ;;</span><br><span class="line">     *)</span><br><span class="line">      echo <span class="string">&quot;输入错误&quot;</span></span><br><span class="line">esac</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2024/03/04/Linux%E4%B8%BB%E6%9C%BA%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B%E8%84%9A%E6%9C%AC%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E8%84%9A%E6%9C%AC/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Scripts/" rel="tag">Scripts</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2024/03/11/Linux%E8%AE%BE%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99%E5%8F%AA%E5%85%81%E8%AE%B8%E7%89%B9%E5%AE%9AIP%E8%AE%BF%E9%97%AE%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            Linux设置防火墙只允许特定IP访问指定端口
          
        </div>
      </a>
    
    
      <a href="/2024/03/01/Zabbix%E9%80%9A%E8%BF%87API%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4%E4%B8%BB%E6%9C%BA/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Zabbix通过API批量添加/删除主机</div>
      </a>
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2024
        <i class="ri-heart-fill heart_icon"></i> JinTao Li
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
        <li>
          <a href="https://beian.miit.gov.cn/" target="_black" rel="nofollow">鲁ICP备88888888</a>
        </li>
        
    </ul>
    <ul>
      
      <li>
          <img src="/images/beian.png"></img>
          <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=01234567890123" target="_black" rel="nofollow">青岛公安网备01234567890123号</a>
      </li>
        
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Lijintao&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://blog.csdn.net/u013235026">CSDN</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.cnblogs.com/jintaoli">博客园</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/images/272a163694dd8a415a43dbf85ac34778.jpg">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=2142256392&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "jintao1210";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "text",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
</body>

</html>