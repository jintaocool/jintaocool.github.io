<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="博客" />
       
      <meta name="description" content="日常随笔" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>blackbox_exporter监控组件 |  Lijintao&#39;s Blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="Lijintao's Blog" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="exporter-blackbox-exporter监控组件"
  class="article article-type-exporter"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  blackbox_exporter监控组件
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/01/12/blackbox-exporter%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6/" class="article-date">
  <time datetime="2024-01-12T02:05:07.000Z" itemprop="datePublished">2024-01-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/exporter/">exporter</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">3.1k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">13 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="【1】Blackbox-exporter-简介"><a href="#【1】Blackbox-exporter-简介" class="headerlink" title="【1】Blackbox_exporter 简介"></a>【1】Blackbox_exporter 简介</h2><h3 id="（1-1）实现功能"><a href="#（1-1）实现功能" class="headerlink" title="（1.1）实现功能"></a>（1.1）实现功能</h3><p>blackbox-exporter项目地址：<a target="_blank" rel="noopener" href="https://github.com/prometheus/blackbox_exporter">https://github.com/prometheus/blackbox_exporter</a></p>
<p>  blackbox_exporter 是 Prometheus 官方提供的一个 exporter，可以监控 HTTP、 HTTPS,、DNS、 TCP 、ICMP 等目标实例，从而实现对被监控节点进行监控 和数据采集。promethes调用blackbox_exporter去访问目标监控服务器，实现指标的采集</p>
<p>  prometheus blackbox_exporter下载地址：<a target="_blank" rel="noopener" href="https://prometheus.io/download/#blackbox_exporter">Download | Prometheus</a></p>
<p>  HTTP&#x2F;HTPPS：URL&#x2F;API 可用性检测</p>
<p>  TCP：端口监听检测</p>
<p>  ICMP：主机存活检测</p>
<p>  DNS：域名解析</p>
<p>黑盒监控和白盒监控：</p>
<p>　　黑盒监控，关注的是实时状态，一般都是正在发生的事件，比如网站访问不了、磁盘无法写入数据等。即黑盒监控的重点是能对正在发生的故障进行告警。常见的黑盒监控包括HTTP探针、TCP探针等用于检测站点或者服务的可访问性，以及访问效率等。</p>
<p>　　白盒监控，关注的是原因，也就是系统内部的一些运行指标数据，例如nginx响应时长、存储I&#x2F;O负载等</p>
<p>　　监控系统要能够有效的支持百盒监控和黑盒监控，通过白盒能够了解系统内部的实际运行状态，以及对监控指标的观察能够预判出可能出现的潜在问题，从而对潜在的不确定因素进行提前处理避免问题发生；</p>
<p>　　而通过黑盒监控，可以在系统或服务发生故障时快速通知相关人员进行处理。</p>
<h3 id="（1-2）下载和部署blackbox-exporter"><a href="#（1-2）下载和部署blackbox-exporter" class="headerlink" title="（1.2）下载和部署blackbox_exporter"></a>（1.2）<strong>下载和部署blackbox_exporter</strong></h3><p>  <a target="_blank" rel="noopener" href="https://github.com/prometheus/blackbox_exporter">https://github.com/prometheus/blackbox_exporter</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/prometheus/blackbox_exporter/releases/download/v0.23.0/blackbox_exporter-0.23.0.linux-amd64.tar.gz</span><br><span class="line">tar xf blackbox_exporter-0.23.0.linux-amd64.tar.gz -C /usr/local/</span><br><span class="line">ln -sv /usr/local/blackbox_exporter-0.23.0.linux-amd64 /usr/local/blackbox_exporter</span><br><span class="line"> /usr/local/blackbox_exporter/blackbox_exporter -h    #查看帮助信息</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>（1.3）blackbox_exporter 配置文件解析</p>
<p> 官方解释: <a target="_blank" rel="noopener" href="https://github.com/prometheus/blackbox/_exporter/blob/master/CONFIGURATION.md">https://github.com/prometheus/blackbox\_exporter/blob/master/CONFIGURATION.md</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">modules:</span><br><span class="line">  http_2xx:</span><br><span class="line">    prober: http</span><br><span class="line">  http_post_2xx:</span><br><span class="line">    prober: http</span><br><span class="line">    http:</span><br><span class="line">      method: POST</span><br><span class="line">  tcp_connect:</span><br><span class="line">    prober: tcp</span><br><span class="line">  pop3s_banner:</span><br><span class="line">    prober: tcp</span><br><span class="line">    tcp:</span><br><span class="line">      query_response:</span><br><span class="line">      - expect: &quot;^+OK&quot;</span><br><span class="line">      tls: true</span><br><span class="line">      tls_config:</span><br><span class="line">        insecure_skip_verify: false</span><br><span class="line">  ssh_banner:</span><br><span class="line">    prober: tcp</span><br><span class="line">    tcp:</span><br><span class="line">      query_response:</span><br><span class="line">      - expect: &quot;^SSH-2.0-&quot;</span><br><span class="line">  irc_banner:</span><br><span class="line">    prober: tcp</span><br><span class="line">    tcp:</span><br><span class="line">      query_response:</span><br><span class="line">      - send: &quot;NICK prober&quot;</span><br><span class="line">      - send: &quot;USER prober prober prober :prober&quot;</span><br><span class="line">      - expect: &quot;PING :([^ ]+)&quot;</span><br><span class="line">        send: &quot;PONG $&#123;1&#125;&quot;</span><br><span class="line">      - expect: &quot;^:[^ ]+ 001&quot;</span><br><span class="line">  icmp:</span><br><span class="line">    prober: icmp</span><br></pre></td></tr></table></figure>

<p>　　运行 blackbox exporter 时,需要用户提供探针的配置信息,这些配置信息可能是一些自定义的 HTTP 头信息,也可能是探测时需要的一些 TSL(秘钥证书) 配置。</p>
<p>　　也可能是探针本身的验证行为.在 blackbox exporter 每一个探针配置称为一个 module,并且以 YAML 配置文件的形式提供给 blackbox exporter。</p>
<p>　　每一个 module 主要包含以下配置内容,探针类型**(prober**),验证访问超时时间(<strong>timeout)</strong>,以及当前探针的具体配置项:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"># 探针类型: http https tcp dns icmp</span><br><span class="line">prober: &lt;prober_string&gt; #必选</span><br><span class="line"></span><br><span class="line"># 超时时间:</span><br><span class="line">[timeout: &lt;duration&gt;] #默认单位秒</span><br><span class="line"></span><br><span class="line"># 探针的详细配置,最多只能配置其中一个</span><br><span class="line">[ http: &lt;http_probe&gt; ]</span><br><span class="line">[ tcp: &lt;tcp_probe&gt; ]</span><br><span class="line">[ dns: &lt;dns_probe&gt; ]</span><br><span class="line">[ icmp: &lt;icmp_probe&gt; ]</span><br><span class="line"></span><br><span class="line">&lt;http_probe&gt;可配置参数</span><br><span class="line"># 此探针接受的状态代码。 默认为2xx。</span><br><span class="line">[ valid_status_codes: &lt;int&gt;, ... | default = 2xx ]</span><br><span class="line"></span><br><span class="line"># 此探针接受的 HTTP 版本.</span><br><span class="line">[ valid_http_versions: &lt;string&gt;, ... ]</span><br><span class="line"></span><br><span class="line">#探针将使用的HTTP方法。</span><br><span class="line">[ method: &lt;string&gt; | default = &quot;GET&quot; ]</span><br><span class="line"></span><br><span class="line"># 为探针设置的HTTP标头。</span><br><span class="line">headers:</span><br><span class="line">[ &lt;string&gt;: &lt;string&gt; ... ]</span><br><span class="line"></span><br><span class="line"># 探针是否将遵循任何重定向</span><br><span class="line">[ no_follow_redirects: &lt;boolean&gt; | default = false ]</span><br><span class="line"></span><br><span class="line"># 如果存在SSL，则探测失败。</span><br><span class="line">[ fail_if_ssl: &lt;boolean&gt; | default = false ]</span><br><span class="line"></span><br><span class="line"># 如果不存在SSL，则探测失败。</span><br><span class="line">[ fail_if_not_ssl: &lt;boolean&gt; | default = false ]</span><br><span class="line"></span><br><span class="line"># 如果响应主体与正则表达式匹配，则探测失败。</span><br><span class="line">fail_if_body_matches_regexp:</span><br><span class="line">[ - &lt;regex&gt;, ... ]</span><br><span class="line"></span><br><span class="line"># 如果响应主体与正则表达式不匹配，则探测失败。</span><br><span class="line">fail_if_body_not_matches_regexp:</span><br><span class="line">[ - &lt;regex&gt;, ... ]</span><br><span class="line"></span><br><span class="line"># 如果响应头与正则表达式匹配，则探测失败。 对于具有多个值的标头，如果*至少一个*匹配，则失败。</span><br><span class="line">fail_if_header_matches:</span><br><span class="line">[ - &lt;http_header_match_spec&gt;, ... ]</span><br><span class="line"></span><br><span class="line"># 如果响应头与正则表达式不匹配，则探测失败。 对于具有多个值的标头，如果* none *不匹配，则失败。</span><br><span class="line">fail_if_header_not_matches:</span><br><span class="line">[ - &lt;http_header_match_spec&gt;, ... ]</span><br><span class="line"></span><br><span class="line"># HTTP探针的TLS协议的配置。</span><br><span class="line">tls_config:</span><br><span class="line">[ &lt;tls_config&gt; ]</span><br><span class="line"></span><br><span class="line"># 目标的HTTP基本身份验证凭据。</span><br><span class="line">basic_auth:</span><br><span class="line">[ username: &lt;string&gt; ]</span><br><span class="line">[ password: &lt;secret&gt; ]</span><br><span class="line"></span><br><span class="line"># 目标的承载令牌。</span><br><span class="line">[ bearer_token: &lt;secret&gt; ]</span><br><span class="line"></span><br><span class="line"># 目标的承载令牌文件</span><br><span class="line">[ bearer_token_file: &lt;filename&gt; ]</span><br><span class="line"></span><br><span class="line"># 用于连接到目标的HTTP代理服务器。</span><br><span class="line">[ proxy_url: &lt;string&gt; ]</span><br><span class="line"></span><br><span class="line"># HTTP探针的IP协议（ip4，ip6）</span><br><span class="line">[ preferred_ip_protocol: &lt;string&gt; | default = &quot;ip6&quot; ]</span><br><span class="line">[ ip_protocol_fallback: &lt;boolean&gt; | default = true ]</span><br><span class="line"></span><br><span class="line"># 探针中使用的HTTP请求的主体。</span><br><span class="line">body: [ &lt;string&gt; ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###################################################################</span><br><span class="line">&lt;http_header_match_spec&gt;</span><br><span class="line">header: &lt;string&gt;,</span><br><span class="line">regexp: &lt;regex&gt;,</span><br><span class="line">[ allow_missing: &lt;boolean&gt; | default = false ]</span><br></pre></td></tr></table></figure>

<h3 id="（1-4）结合-prometheus（ping）"><a href="#（1-4）结合-prometheus（ping）" class="headerlink" title="（1.4）结合 prometheus（ping）"></a>（1.4）结合 prometheus（ping）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- job_name: &#x27;blackbox-ping&#x27;</span><br><span class="line">  metrics_path: /probe</span><br><span class="line">  params:</span><br><span class="line">    modelus: [icmp]</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets:</span><br><span class="line">    - 223.5.5.5</span><br><span class="line">    lables:</span><br><span class="line">      instance: aliyun</span><br><span class="line">  - targets:</span><br><span class="line">    - 47.92.229.67</span><br><span class="line">    lables:</span><br><span class="line">      instance: zsf</span><br><span class="line">  relabel_configs:</span><br><span class="line">    - source_labels: [__address__]</span><br><span class="line">      target_label: __param_target</span><br><span class="line">    - source_labels: [__param_target]</span><br><span class="line">      target_label: instance</span><br><span class="line">    - target_label: __address__</span><br><span class="line">      replacement: 192.168.111.65:9115</span><br></pre></td></tr></table></figure>

<h3 id="（1-5）http"><a href="#（1-5）http" class="headerlink" title="（1.5）http"></a>（1.5）http</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">modules:</span><br><span class="line">  http_2xx:</span><br><span class="line">    prober: http</span><br><span class="line">    http:</span><br><span class="line">      method: GET</span><br><span class="line">  http_post_2xx:</span><br><span class="line">    prober: http</span><br><span class="line">    http:</span><br><span class="line">      method: POST</span><br></pre></td></tr></table></figure>

<p>配置好之后运行如指令 <strong>curl url:9115&#x2F;metrics</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#DNS解析时间,单位 s</span><br><span class="line">probe_dns_lookup_time_seconds 0.039431355</span><br><span class="line">#探测从开始到结束的时间,单位 s,请求这个页面响应时间</span><br><span class="line">probe_duration_seconds 0.651619323</span><br><span class="line"></span><br><span class="line">probe_failed_due_to_regex 0</span><br><span class="line"></span><br><span class="line">#HTTP 内容响应的长度</span><br><span class="line">probe_http_content_length -1</span><br><span class="line">#按照阶段统计每阶段的时间</span><br><span class="line">probe_http_duration_seconds&#123;phase=&quot;connect&quot;&#125; 0.050388884 #连接时间</span><br><span class="line">probe_http_duration_seconds&#123;phase=&quot;processing&quot;&#125; 0.45868667 #处理请求的时间</span><br><span class="line">probe_http_duration_seconds&#123;phase=&quot;resolve&quot;&#125; 0.040037612 #响应时间</span><br><span class="line">probe_http_duration_seconds&#123;phase=&quot;tls&quot;&#125; 0.145433254 #校验证书的时间</span><br><span class="line">probe_http_duration_seconds&#123;phase=&quot;transfer&quot;&#125; 0.000566269</span><br><span class="line">#重定向的次数</span><br><span class="line">probe_http_redirects 1</span><br><span class="line">#ssl 指示是否将 SSL 用于最终重定向</span><br><span class="line">probe_http_ssl 1</span><br><span class="line">#返回的状态码</span><br><span class="line">probe_http_status_code 200</span><br><span class="line">#未压缩的响应主体长度</span><br><span class="line">probe_http_uncompressed_body_length 40339</span><br><span class="line">#http 协议的版本</span><br><span class="line">probe_http_version 1.1</span><br><span class="line">#使用的 ip 协议的版本号</span><br><span class="line">probe_ip_protocol 4</span><br><span class="line"></span><br><span class="line">probe_ssl_earliest_cert_expiry 1.59732e+09</span><br><span class="line">#是否探测成功</span><br><span class="line">probe_success 1</span><br><span class="line">#TLS 的版本号</span><br><span class="line">probe_tls_version_info&#123;version=&quot;TLS 1.2&quot;&#125; 1</span><br></pre></td></tr></table></figure>

<p>与 prometheus 集成,采用prometheus 的 Relabelinng 能力(服务发现)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- job_name: &#x27;blackbox-http&#x27;</span><br><span class="line">  metrics_path: /probe</span><br><span class="line">  params:</span><br><span class="line">    modelue: [http_2xx]</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets:</span><br><span class="line">    - http://www.zhangshoufu.com</span><br><span class="line">    - http://www.xuliangwei.com</span><br><span class="line">  relabel_configs:</span><br><span class="line">    - source_labels: [__address__]</span><br><span class="line">      target_label: __param_target</span><br><span class="line">    - source_labels: [__param_target]</span><br><span class="line">      target_label: instance</span><br><span class="line">    - target_label: __address__</span><br><span class="line">      replacement: 192.168.111.65:9115  #blackbox-exporter 所在的机器和端口</span><br></pre></td></tr></table></figure>

<p>这里针对每一个探针服务（如http_2xx）定义一个采集任务，并且直接将任务的采集目标定义为我们需要探测的站点。在采集样本数据之前通过relabel_configs对采集任务进行动态设置。</p>
<p>1, 根据 Target 实例的地址,写入__param_target 标签中,__param_<name>形式的标签表示,在采集任务时会在请求目标地址中添加<name>参数,等同于 params 的设置</p>
<p>2, 获取__param_target的值，并覆写到instance标签中；</p>
<p>3, 覆写Target实例的__address__标签值为BlockBox Exporter实例的访问地址。  </p>
<h3 id="（1-6）-自定义-HTTP-请求（通过-POST），HTTPS"><a href="#（1-6）-自定义-HTTP-请求（通过-POST），HTTPS" class="headerlink" title="（1.6） 自定义 HTTP 请求（通过 POST），HTTPS"></a>（1.6） 自定义 HTTP 请求（通过 POST），HTTPS</h3><p>自定义 HTTP 请求</p>
<p>　　HTTP服务通常会以不同的形式对外展现，有些可能就是一些简单的网页，而有些则可能是一些基于REST的API服务。</p>
<p>　　对于不同类型的HTTP的探测需要管理员能够对HTTP探针的行为进行更多的自定义设置，包括：HTTP请求方法、HTTP头信息、请求参数等。对于某些启用了安全认证的服务还需要能够对HTTP探测设置相应的Auth支持。</p>
<p>　　对于HTTPS类型的服务还需要能够对证书进行自定义设置。</p>
<p>如下所示，这里通过method定义了探测时使用的请求方法，对于一些需要请求参数的服务，还可以通过headers定义相关的请求头信息，使用body定义请求内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http_post_2xx:</span><br><span class="line">    prober: http</span><br><span class="line">    timeout: 5s</span><br><span class="line">    http:</span><br><span class="line">      method: POST</span><br><span class="line">      headers:</span><br><span class="line">        Content-Type: application/json</span><br><span class="line">      body: &#x27;&#123;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>自定义探针行为</strong><br>在默认情况下HTTP探针只会对HTTP返回状态码进行校验，如果状态码为2XX（200 &lt;&#x3D; StatusCode &lt; 300）则表示探测成功，并且探针返回的指标probe_success值为1。<br>如果用户需要指定HTTP返回状态码，或者对HTTP版本有特殊要求，如下所示，可以使用valid_http_versions和valid_status_codes进行定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http_2xx_example:</span><br><span class="line">    prober: http</span><br><span class="line">    timeout: 5s</span><br><span class="line">    http:</span><br><span class="line">      valid_http_versions: [&quot;HTTP/1.1&quot;, &quot;HTTP/2&quot;]</span><br><span class="line">      valid_status_codes: [200,301,302]</span><br></pre></td></tr></table></figure>

<p>默认情况下，Blockbox返回的样本数据中也会包含指标probe_http_ssl，用于表明当前探针是否使用了SSL：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  http_2xx_example:    prober: http    timeout: 5s    http:      valid_status_codes: []      method: GET      no_follow_redirects:</span><br><span class="line">false</span><br><span class="line">      fail_if_ssl:</span><br><span class="line">false</span><br><span class="line">      fail_if_not_ssl:</span><br><span class="line">false</span><br></pre></td></tr></table></figure>


<p>而如果用户对于HTTP服务是否启用SSL有强制的标准。则可以使用fail_if_ssl和fail_if_not_ssl进行配置。fail_if_ssl为true时，表示如果站点启用了SSL则探针失败，反之成功。fail_if_not_ssl刚好相反。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http_2xx_example:</span><br><span class="line">  prober: http</span><br><span class="line">  timeout: 5s</span><br><span class="line">  http:</span><br><span class="line">    method: GET</span><br><span class="line">    fail_if_matches_regexp:</span><br><span class="line">      - &quot;Could not connect to database&quot;</span><br><span class="line">    fail_if_not_matches_regexp:</span><br><span class="line">      - &quot;Download the latest version here&quot;</span><br></pre></td></tr></table></figure>

<p>除了基于HTTP状态码，HTTP协议版本以及是否启用SSL作为控制探针探测行为成功与否的标准以外，还可以匹配HTTP服务的响应内容。</p>
<p>使用 <strong>fail_if_matches_regexp 和 fail_if_not_matches_regexp</strong> 用户可以定义一组正则表达式，用于验证HTTP返回内容是否符合或者不符合正则表达式的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http_2xx_example:</span><br><span class="line">prober: http</span><br><span class="line">timeout: 5s</span><br><span class="line">http:</span><br><span class="line">method: GET</span><br><span class="line">fail_if_matches_regexp:</span><br><span class="line">- &quot;Could not connect to database&quot;</span><br><span class="line">fail_if_not_matches_regexp:</span><br><span class="line">- &quot;Download the latest version here&quot;</span><br></pre></td></tr></table></figure>

<p>具体可以看我上面的配置详解</p>
<h3 id="（1-7）https-与-tls，证书与秘钥安全认证"><a href="#（1-7）https-与-tls，证书与秘钥安全认证" class="headerlink" title="（1.7）https 与 tls，证书与秘钥安全认证"></a>（1.7）https 与 tls，证书与秘钥安全认证</h3><p>如果HTTP服务启用了<strong>安全认证</strong>，Blockbox Exporter内置了对basic_auth的支持，可以直接设置相关的认证信息即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">http_basic_auth_example:</span><br><span class="line">    prober: http</span><br><span class="line">    timeout: 5s</span><br><span class="line">    http:</span><br><span class="line">      method: POST</span><br><span class="line">      headers:</span><br><span class="line">        Host: &quot;login.example.com&quot;</span><br><span class="line">      basic_auth:</span><br><span class="line">        username: &quot;username&quot;</span><br><span class="line">        password: &quot;mysecret&quot;</span><br></pre></td></tr></table></figure>

<p>对于使用了Bear Token的服务也可以通过bearer_token配置项直接指定令牌字符串，或者通过bearer_token_file指定令牌文件。</p>
<p>　　对于一些启用了 HTTPS的服务，但是需要<strong>自定义证书的服务</strong>，可以通过tls_config指定相关的证书信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http_custom_ca_example:</span><br><span class="line">    prober: http</span><br><span class="line">    http:</span><br><span class="line">      method: GET</span><br><span class="line">      tls_config:</span><br><span class="line">        ca_file: &quot;/certs/my_cert.crt&quot;</span><br></pre></td></tr></table></figure>

<h3 id="http-忽略过期证书-跳过过期证书最佳实践"><a href="#http-忽略过期证书-跳过过期证书最佳实践" class="headerlink" title="http 忽略过期证书,跳过过期证书最佳实践"></a><strong>http 忽略过期证书,跳过过期证书最佳实践</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http_2xx:</span><br><span class="line">  prober: http</span><br><span class="line">  http:</span><br><span class="line">    method: GET</span><br><span class="line">    tls_config:</span><br><span class="line">      insecure_skip_verify: true</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">modules:</span><br><span class="line">  http_2xx:</span><br><span class="line">    prober: http</span><br><span class="line">    timeout: 5s</span><br><span class="line">    http:</span><br><span class="line">      valid_http_versions: [&quot;HTTP/1.1&quot;, &quot;HTTP/2.0&quot;]</span><br><span class="line">      method: GET</span><br><span class="line">      preferred_ip_protocol: &quot;ip4&quot;</span><br><span class="line">      ip_protocol_fallback: false</span><br><span class="line">      no_follow_redirects: false</span><br><span class="line">      fail_if_ssl: false</span><br><span class="line">      fail_if_not_ssl: false</span><br><span class="line">      tls_config:</span><br><span class="line">        insecure_skip_verify: true</span><br></pre></td></tr></table></figure>

<p>　　　　<img src="/images/1705025026-9501eb78805ce1382788d246287b7bd4.png"></p>
<p>要使用 blackbox_exporter 监控 HTTPS 网址，您需要在 <code>probe_http_modules</code> 部分中指定 <code>tls_config</code>。</p>
<p><strong>首先，您需要创建一个包含证书和密钥的 PEM 文件</strong>。然后，您可以将该文件路径指定为 <code>tls_config</code> 内的 <code>cert_file</code> 和 <code>key_file</code> 字段。</p>
<p>此外，您需要将 <code>http</code> 模块更改为 <code>https</code> 模块，以便 blackbox_exporter 使用 HTTPS 进行连接。以下是一个示例配置文件片段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">modules:</span><br><span class="line">  http_2xx:</span><br><span class="line">    prober: https</span><br><span class="line">    timeout: 5s</span><br><span class="line">    http:</span><br><span class="line">      preferred_ip_protocol: &quot;ip4&quot;</span><br><span class="line">      tls_config:</span><br><span class="line">        cert_file: /path/to/cert.pem</span><br><span class="line">        key_file: /path/to/key.pem</span><br></pre></td></tr></table></figure>

<p>请注意，在使用 HTTPS 进行连接时，黑盒探针将验证服务器的证书。如果您使用自签名证书或无效证书，则需要设置 <code>tls_config</code> 中的 <code>insecure_skip_verify</code> 选项为 <code>true</code>。</p>
<h3 id="（1-X）启动与验证"><a href="#（1-X）启动与验证" class="headerlink" title="（1.X）启动与验证"></a>（1.X）启动与验证</h3><p><strong>启动：.&#x2F;blackbox_exporter –config.file&#x3D;blackbox.yml</strong></p>
<p><strong>验证：</strong></p>
<p>　　方法1：curl <a href="http://172.16.10.65:9115/probe?target=prometheus.io&module=http%5C_2xx&debug=true">http://172.16.10.65:9115/probe?target=prometheus.io&amp;module=http\_2xx&amp;debug=true</a></p>
<p>　　方法2：blackbox_exporter访问验证</p>
<p><img src="/images/1705025026-225f577fa40457a8f5762cc95b7d994b.png"></p>
<p>  prometheus-server服务验证</p>
<p>　　<img src="/images/1705025026-52628c092d13d8e750525b72814b72bb.png"></p>
<h2 id="【2】rules-基本告警"><a href="#【2】rules-基本告警" class="headerlink" title="【2】rules 基本告警"></a>【2】rules 基本告警</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">groups:</span><br><span class="line">- name: example</span><br><span class="line">  rules:</span><br><span class="line">  - alert: curlHttpStatus</span><br><span class="line">    expr:  probe_http_status_code&#123;job=&quot;blackbox-http&quot;&#125;&gt;=400 and probe_success&#123;job=&quot;blackbox-http&quot;&#125;==0</span><br><span class="line">    #for: 1m</span><br><span class="line">    labels:</span><br><span class="line">      docker: number</span><br><span class="line">    annotations:</span><br><span class="line">      summary: &#x27;业务报警: 网站不可访问&#x27;</span><br><span class="line">      description: &#x27;&#123;&#123;$labels.instance&#125;&#125; 不可访问,请及时查看,当前状态码为&#123;&#123;$value&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>


<h2 id="【3】grafana导入模板"><a href="#【3】grafana导入模板" class="headerlink" title="【3】grafana导入模板"></a>【3】<strong>grafana导入模板</strong></h2><p>  模板：ID-13587、ID-9965</p>
<p>　　<img src="/images/1705025026-80e6662ce004d41239bea3ef49c89897.png"></p>
<p>　　<img src="/images/1705025026-b4dfe0fdedb6706ec3a03417eae9e0c9.png"></p>
<h2 id="【最佳实践】"><a href="#【最佳实践】" class="headerlink" title="【最佳实践】"></a>【最佳实践】</h2><h3 id="（1）prometheus-整合-blackbox-exporter-（HTTP-Ping）"><a href="#（1）prometheus-整合-blackbox-exporter-（HTTP-Ping）" class="headerlink" title="（1）prometheus 整合 blackbox_exporter （HTTP&#x2F;Ping）"></a>（1）prometheus 整合 blackbox_exporter （HTTP&#x2F;Ping）</h3><p>ping</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- job_name: &#x27;blackbox-ping-IT设备&#x27;</span><br><span class="line">  params:</span><br><span class="line">    module: [icmp]</span><br><span class="line">  metrics_path: /probe</span><br><span class="line">  static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      - 192.168.1.1</span><br><span class="line">      labels:</span><br><span class="line">        name: &#x27;桌面云服务器-linx7（F12-17U）&#x27;</span><br><span class="line">        source_type: B机房</span><br><span class="line">    - targets:</span><br><span class="line">      - 192.168.1.2</span><br><span class="line">      labels:</span><br><span class="line">        name: &#x27;桌面云服务器-linx7（F12-20U）&#x27;</span><br><span class="line">        source_type: B机房</span><br><span class="line">  relabel_configs:</span><br><span class="line">    - source_labels: [__address__]</span><br><span class="line">      target_label: __param_target</span><br><span class="line">    - source_labels: [__param_target]</span><br><span class="line">      target_label: instance</span><br><span class="line">    - target_label: __address__</span><br><span class="line">      replacement: 127.0.0.1:9115</span><br></pre></td></tr></table></figure>

<p>Http：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- job_name: &#x27;blackbox-http-业务模块&#x27;</span><br><span class="line">  params:</span><br><span class="line">    modelue: [http_2xx]</span><br><span class="line">  metrics_path: /probe</span><br><span class="line">  static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      - http://www.baidu.com</span><br><span class="line">      labels:</span><br><span class="line">        name: &#x27;a系统&#x27;</span><br><span class="line">        source_type: 信息科技部</span><br><span class="line">    - targets:</span><br><span class="line">      - https://www.abc.com</span><br><span class="line">      labels:</span><br><span class="line">        name: &#x27;abc官网&#x27;</span><br><span class="line">        source_type: 信息科技部</span><br><span class="line">    - targets:</span><br><span class="line">      - http://192.168.1.1:7180</span><br><span class="line">      labels:</span><br><span class="line">        name: &#x27;CDH-cm&#x27;</span><br><span class="line">        source_type: 大数据风控部</span><br><span class="line">    - targets:</span><br><span class="line">      - http://192.168.1.2:8088/</span><br><span class="line">      labels:</span><br><span class="line">        name: &#x27;a&#x27;</span><br><span class="line">        source_type: 大数据风控部</span><br><span class="line">  relabel_configs:</span><br><span class="line">    - source_labels: [__address__]</span><br><span class="line">      target_label: __param_target</span><br><span class="line">    - source_labels: [__param_target]</span><br><span class="line">      target_label: instance</span><br><span class="line">    - target_label: __address__</span><br><span class="line">      replacement: 127.0.0.1:9115</span><br></pre></td></tr></table></figure>

<h3 id="（2）服务发现"><a href="#（2）服务发现" class="headerlink" title="（2）服务发现"></a>（2）服务发现</h3><p>prometheus</p>
<p><img src="/images/1705025026-0165bd681c9a08a1d2a2612202bd332c.png"></p>
<p>url.json</p>
<p><img src="/images/1705025026-5fe3966982d397ec6268d8d770ecc2d3.jpg"></p>
<h3 id="（3）SSL证书监控"><a href="#（3）SSL证书监控" class="headerlink" title="（3）SSL证书监控"></a>（3）SSL证书监控</h3><p> http里面就有，如下表达式，就是检测证书到期时间是否&lt;90天</p>
<p>(probe_ssl_earliest_cert_expiry{} - time()   )&#x2F;3600&#x2F;24 &lt;90</p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2024/01/12/blackbox-exporter%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/exporter/" rel="tag">exporter</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2024/01/12/%E9%83%A8%E7%BD%B2%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6%E6%8A%A5%E9%94%99%EF%BC%9Acurl-60-Peer%E2%80%98s-certificate-issuer-is-not-recognized/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            部署自签证书报错：curl: (60) Peer‘s certificate issuer is not recognized
          
        </div>
      </a>
    
    
      <a href="/2024/01/10/Prometheus%E9%9B%86%E6%88%90consul-%E8%A2%AB%E7%9B%91%E6%8E%A7%E5%AF%B9%E8%B1%A1%E5%BC%80%E5%90%AFbasic%E8%AE%A4%E8%AF%81/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Prometheus集成consul[被监控对象开启basic认证]</div>
      </a>
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2024
        <i class="ri-heart-fill heart_icon"></i> JinTao Li
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
        <li>
          <a href="https://beian.miit.gov.cn/" target="_black" rel="nofollow">鲁ICP备88888888</a>
        </li>
        
    </ul>
    <ul>
      
      <li>
          <img src="/images/beian.png"></img>
          <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=01234567890123" target="_black" rel="nofollow">青岛公安网备01234567890123号</a>
      </li>
        
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Lijintao&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://blog.csdn.net/u013235026">CSDN</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.cnblogs.com/jintaoli">博客园</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=2049529248&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "jintao1210";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "text",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
</body>

</html>